+ cd /home/manager/course_data/variant_calling/data
+ samtools --help

Program: samtools (Tools for alignments in the SAM format)
Version: 1.15.1 (using htslib 1.16)

Usage:   samtools <command> [options]

Commands:
  -- Indexing
     dict           create a sequence dictionary file
     faidx          index/extract FASTA
     fqidx          index/extract FASTQ
     index          index alignment

  -- Editing
     calmd          recalculate MD/NM tags and '=' bases
     fixmate        fix mate information
     reheader       replace BAM header
     targetcut      cut fosmid regions (for fosmid pool only)
     addreplacerg   adds or replaces RG tags
     markdup        mark duplicates
     ampliconclip   clip oligos from the end of reads

  -- File operations
     collate        shuffle and group alignments by name
     cat            concatenate BAMs
     consensus      produce a consensus Pileup/FASTA/FASTQ
     merge          merge sorted alignments
     mpileup        multi-way pileup
     sort           sort alignment file
     split          splits a file by read group
     quickcheck     quickly check if SAM/BAM/CRAM file appears intact
     fastq          converts a BAM to a FASTQ
     fasta          converts a BAM to a FASTA
     import         Converts FASTA or FASTQ files to SAM/BAM/CRAM

  -- Statistics
     bedcov         read depth per BED region
     coverage       alignment depth and percent coverage
     depth          compute the depth
     flagstat       simple stats
     idxstats       BAM index stats
     phase          phase heterozygotes
     stats          generate stats (former bamcheck)
     ampliconstats  generate amplicon specific stats

  -- Viewing
     flags          explain BAM flags
     head           header viewer
     tview          text alignment viewer
     view           SAM<->BAM<->CRAM conversion
     depad          convert padded BAM to unpadded BAM
     samples        list the samples in a set of SAM/BAM/CRAM files

  -- Misc
     help [cmd]     display this help message or help for [cmd]
     version        detailed version information

+ bcftools --help

Program: bcftools (Tools for variant calling and manipulating VCFs and BCFs)
License: GNU GPLv3+, due to use of the GNU Scientific Library
Version: 1.15.1 (using htslib 1.16)

Usage:   bcftools [--version|--version-only] [--help] <command> <argument>

Commands:

 -- Indexing
    index        index VCF/BCF files

 -- VCF/BCF manipulation
    annotate     annotate and edit VCF/BCF files
    concat       concatenate VCF/BCF files from the same set of samples
    convert      convert VCF/BCF files to different formats and back
    head         view VCF/BCF file headers
    isec         intersections of VCF/BCF files
    merge        merge VCF/BCF files files from non-overlapping sample sets
    norm         left-align and normalize indels
    plugin       user-defined plugins
    query        transform VCF/BCF into user-defined formats
    reheader     modify VCF/BCF header, change sample names
    sort         sort VCF/BCF file
    view         VCF/BCF conversion, view, subset and filter VCF/BCF files

 -- VCF/BCF analysis
    call         SNP/indel calling
    consensus    create consensus sequence by applying VCF variants
    cnv          HMM CNV calling
    csq          call variation consequences
    filter       filter VCF/BCF files using fixed thresholds
    gtcheck      check sample concordance, detect sample swaps and contamination
    mpileup      multi-way pileup producing genotype likelihoods
    polysomy     detect number of chromosomal copies
    roh          identify runs of autozygosity (HMM)
    stats        produce VCF/BCF stats

 -- Plugins (collection of programs for calling, file manipulation & analysis)
    38 plugins available, run "bcftools plugin -lv" to see a complete list

 Most commands accept VCF, bgzipped VCF, and BCF with the file type detected
 automatically even when streaming from a pipe. Indexed VCF and BCF will work
 in all situations. Un-indexed VCF and BCF and streams will work in most but
 not all situations.

+ samtools stats -r GRCm38_68.19.fa A_J.bam
+ samtools stats -r GRCm38_68.19.fa NZO.bam
+ plot-bamstats -s GRCm38_68.19.fa
+ plot-bamstats -r GRCm38_68.19.fa.gc -p A_J.graphs/ A_J.stats
"A_J.graphs/quals2.gp" line 626: warning: y2 axis range undefined or overflow
+ plot-bamstats -r GRCm38_68.19.fa.gc -p NZO.graphs/ NZO.stats
"NZO.graphs/quals2.gp" line 626: warning: y2 axis range undefined or overflow
+ head
+ samtools mpileup -f GRCm38_68.19.fa A_J.bam
[mpileup] 1 samples in 1 input files
19	9999902	G	1	^],	D
19	9999903	T	1	,	B
19	9999904	G	0	*	*
19	9999905	C	2	,^],	=@
19	9999906	T	2	,,	5H
19	9999907	G	3	,,^],	EG@
19	9999908	C	3	,,,	DGB
19	9999909	C	3	,,,	CAE
19	9999910	T	4	,,,^],	@DE6
19	9999911	G	4	,,,,	FDGE
+ head
+ bcftools mpileup -f GRCm38_68.19.fa A_J.bam
[mpileup] 1 samples in 1 input files
##fileformat=VCFv4.2
##FILTER=<ID=PASS,Description="All filters passed">
##bcftoolsVersion=1.15.1+htslib-1.16
##bcftoolsCommand=mpileup -f GRCm38_68.19.fa A_J.bam
##reference=file://GRCm38_68.19.fa
##contig=<ID=1,length=195471971>
##contig=<ID=10,length=130694993>
##contig=<ID=11,length=122082543>
##contig=<ID=12,length=120129022>
##contig=<ID=13,length=120421639>
[mpileup] maximum number of reads per input file set to -d 250
+ head
+ bcftools call -m
+ bcftools mpileup -f GRCm38_68.19.fa A_J.bam
[mpileup] 1 samples in 1 input files
Note: none of --samples-file, --ploidy or --ploidy-file given, assuming all sites are diploid
##fileformat=VCFv4.2
##FILTER=<ID=PASS,Description="All filters passed">
##bcftoolsVersion=1.15.1+htslib-1.16
##bcftoolsCommand=mpileup -f GRCm38_68.19.fa A_J.bam
##reference=file://GRCm38_68.19.fa
##contig=<ID=1,length=195471971>
##contig=<ID=10,length=130694993>
##contig=<ID=11,length=122082543>
##contig=<ID=12,length=120129022>
##contig=<ID=13,length=120421639>
[mpileup] maximum number of reads per input file set to -d 250
+ bcftools call -mv -o out.vcf
Note: none of --samples-file, --ploidy or --ploidy-file given, assuming all sites are diploid
+ bcftools mpileup -a AD -f GRCm38_68.19.fa A_J.bam -Ou
[mpileup] 1 samples in 1 input files
[mpileup] maximum number of reads per input file set to -d 250
+ tail out.vcf
19	10995508	.	T	C	225.417	.	DP=51;VDB=0.656201;SGB=-0.693147;MQSBZ=0.960769;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,26,24;MQ=59	GT:PL:AD	1/1:255,151,0:0,50
19	10995587	.	T	C	225.417	.	DP=36;VDB=0.572009;SGB=-0.693139;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,13,23;MQ=60	GT:PL:AD	1/1:255,108,0:0,36
19	10995605	.	A	AGCAG	228.407	.	INDEL;IDV=23;IMF=0.741935;DP=31;VDB=0.00615819;SGB=-0.692352;RPBZ=-3.06386;MQBZ=0;MQSBZ=0;SCBZ=-4.97188;FS=0;MQ0F=0;AC=2;AN=2;DP4=1,0,7,14;MQ=60	GT:PL:AD	1/1:255,53,0:1,21
19	10995606	.	T	G	123.415	.	DP=22;VDB=0.00296109;SGB=-0.590765;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,2,3;MQ=60	GT:PL:AD	1/1:153,15,0:0,5
19	10995608	.	A	G	116.415	.	DP=22;VDB=0.00296109;SGB=-0.590765;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,2,3;MQ=60	GT:PL:AD	1/1:146,15,0:0,5
19	10995609	.	T	C	121.415	.	DP=22;VDB=0.0134537;SGB=-0.689466;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,6,10;MQ=60	GT:PL:AD	1/1:151,48,0:0,16
19	10995938	.	C	T	225.417	.	DP=55;VDB=0.724804;SGB=-0.693147;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,31,22;MQ=60	GT:PL:AD	1/1:255,160,0:0,53
19	10996876	.	C	T	225.417	.	DP=55;VDB=0.382165;SGB=-0.693147;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,32,23;MQ=60	GT:PL:AD	1/1:255,166,0:0,55
19	10999808	.	C	A	225.417	.	DP=58;VDB=0.409226;SGB=-0.693147;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,33,25;MQ=60	GT:PL:AD	1/1:255,175,0:0,58
19	10999916	.	T	G	225.417	.	DP=71;VDB=0.977212;SGB=-0.693147;MQSBZ=0;FS=0;MQ0F=0;AC=2;AN=2;DP4=0,0,35,36;MQ=60	GT:PL:AD	1/1:255,214,0:0,71
+ head
+ bcftools query --format 'POS=%POS\n' out.vcf
POS=10000104
POS=10000105
POS=10001946
POS=10001994
POS=10002249
POS=10002281
POS=10002676
POS=10002682
POS=10002723
POS=10002815
+ head
+ bcftools query '-f%POS %REF,%ALT\n' out.vcf
10000104 TTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTC,TTCTCTCTCTCTCTCTCTCTCTC
10000105 T,G
10001946 A,G
10001994 A,G
10002249 C,T
10002281 TTGTATGTATGTATGTATGTATGTATGTATGTATGTAT,TTGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTAT
10002676 C,T
10002682 C,T
10002723 GCACACACACACACACAC,GCACACACACACAC
10002815 ATTTTTTTTTTTTT,ATTTTTTTTTTTTTT
+ head
+ bcftools query '-f%POS %QUAL [%GT %AD] %REF %ALT\n' out.vcf
10000104 228.287 1/1 1,12 TTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTC TTCTCTCTCTCTCTCTCTCTCTC
10000105 103.415 1/1 0,26 T G
10001946 225.417 1/1 0,74 A G
10001994 228.411 1/1 1,68 A G
10002249 225.422 1/1 0,73 C T
10002281 225.417 1/1 0,22 TTGTATGTATGTATGTATGTATGTATGTATGTATGTAT TTGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTAT
10002676 225.417 1/1 0,37 C T
10002682 228.373 1/1 1,30 C T
10002723 228.347 1/1 1,31 GCACACACACACACACAC GCACACACACACAC
10002815 196.068 1/1 6,22 ATTTTTTTTTTTTT ATTTTTTTTTTTTTT
+ head
+ bcftools query '-f%POS %QUAL [%GT %AD] %REF %ALT\n' '-iQUAL>=30' out.vcf
10000104 228.287 1/1 1,12 TTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTCTC TTCTCTCTCTCTCTCTCTCTCTC
10000105 103.415 1/1 0,26 T G
10001946 225.417 1/1 0,74 A G
10001994 228.411 1/1 1,68 A G
10002249 225.422 1/1 0,73 C T
10002281 225.417 1/1 0,22 TTGTATGTATGTATGTATGTATGTATGTATGTATGTAT TTGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTATGTAT
10002676 225.417 1/1 0,37 C T
10002682 228.373 1/1 1,30 C T
10002723 228.347 1/1 1,31 GCACACACACACACACAC GCACACACACACAC
10002815 196.068 1/1 6,22 ATTTTTTTTTTTTT ATTTTTTTTTTTTTT
+ head
+ bcftools query '-f%POS %QUAL [%GT %AD] %REF %ALT\n' '-iQUAL>=30 && type="snp"' out.vcf
10000105 103.415 1/1 0,26 T G
10001946 225.417 1/1 0,74 A G
10001994 228.411 1/1 1,68 A G
10002249 225.422 1/1 0,73 C T
10002676 225.417 1/1 0,37 C T
10002682 228.373 1/1 1,30 C T
10003232 225.417 1/1 0,55 G A
10003248 228.417 1/1 1,59 T C
10003440 225.417 1/1 0,45 A C
10003441 225.417 1/1 0,46 G A
+ head
+ bcftools stats out.vcf
# This file was produced by bcftools stats (1.15.1+htslib-1.16) and can be plotted using plot-vcfstats.
# The command line was:	bcftools stats  out.vcf
#
# Definition of sets:
# ID	[2]id	[3]tab-separated file names
ID	0	out.vcf
# SN, Summary numbers:
#   number of records   .. number of data rows in the VCF
#   number of no-ALTs   .. reference-only sites, ALT is either "." or identical to REF
#   number of SNPs      .. number of rows with a SNP
+ grep TSTV
+ bcftools stats out.vcf
# TSTV, transitions/transversions:
# TSTV	[2]id	[3]ts	[4]tv	[5]ts/tv	[6]ts (1st ALT)	[7]tv (1st ALT)	[8]ts/tv (1st ALT)
TSTV	0	1631	700	2.33	1631	700	2.33
+ cut -f5
+ grep TSTV
+ bcftools stats out.vcf
# TSTV, transitions/transversions:
[5]ts/tv
2.33
+ bcftools filter -s LowQual '-iQUAL>=30 && AD[*:1]>=25' -g8 -G10 out.vcf -o out.flt.vcf
+ ls A_J.bam NZO.bam
A_J.bam
NZO.bam
+ bcftools call -mv -Ob -o multi.bcf
+ bcftools mpileup -a AD -f GRCm38_68.19.fa A_J.bam NZO.bam -Ou
[mpileup] 2 samples in 2 input files
Note: none of --samples-file, --ploidy or --ploidy-file given, assuming all sites are diploid
[mpileup] maximum number of reads per input file set to -d 250
+ bcftools index multi.bcf
+ bcftools filter -s LowQual '-iQUAL>=30 && AD[*:1]>=25' -g8 -G10 multi.bcf -Ob -o multi.filt.bcf
+ bcftools index multi.filt.bcf
+ bcftools view -H -r 19:10001946 multi.filt.bcf
19	10001946	.	A	G	216.008	PASS	DP=144;VDB=0.175868;SGB=49.7367;RPBZ=-0.58609;MQBZ=-0.958603;MQSBZ=0.986013;BQBZ=-0.629651;SCBZ=-1.43238;FS=0;MQ0F=0;AC=2;AN=4;DP4=33,35,39,35;MQ=59	GT:PL:AD	1/1:255,223,0:0,74	0/0:0,205,255:68,0
+ bcftools view -H -r 19:10072443 multi.filt.bcf
19	10072443	.	T	A	25.093	LowQual	DP=80;VDB=1.97212e-05;SGB=4.00342;RPBZ=4.35645;MQBZ=0;MQSBZ=0;BQBZ=-2.45202;SCBZ=5.03379;FS=0;MQ0F=0;AC=1;AN=4;DP4=42,29,3,5;MQ=60	GT:PL:AD	0/1:59,0,107:18,8	0/0:0,160,255:53,0
+ bcftools csq -p m -f GRCm38_68.19.fa -g Mus_musculus.part.gff3.gz -Ob -o multi.filt.annot.bcf
+ bcftools view -i 'FILTER="PASS"' multi.filt.bcf
Parsing Mus_musculus.part.gff3.gz ...
Indexed 98 transcripts, 734 exons, 527 CDSs, 183 UTRs
Calling...
+ bcftools index multi.filt.annot.bcf
+ bcftools query -f %BCSQ -r 19:10088937 multi.filt.annot.bcf
missense|Fads2|ENSMUST00000025567|protein_coding|-|163V>163I|10088937C>T+ head
+ bcftools call -mv
Note: none of --samples-file, --ploidy or --ploidy-file given, assuming all sites are diploid
+ bcftools mpileup -f GRCm38_68.19.fa A_J.bam
[mpileup] 1 samples in 1 input files
##fileformat=VCFv4.2
##FILTER=<ID=PASS,Description="All filters passed">
##bcftoolsVersion=1.15.1+htslib-1.16
##bcftoolsCommand=mpileup -f GRCm38_68.19.fa A_J.bam
##reference=file://GRCm38_68.19.fa
##contig=<ID=1,length=195471971>
##contig=<ID=10,length=130694993>
##contig=<ID=11,length=122082543>
##contig=<ID=12,length=120129022>
##contig=<ID=13,length=120421639>
[mpileup] maximum number of reads per input file set to -d 250
+ head
+ bcftools query '-f%POS %QUAL [%GT %AD] %REF %ALT\n' '-iQUAL>=30 && type="snp" && AD[*:1]>=25' out.vcf
10000105 103.415 1/1 0,26 T G
10001946 225.417 1/1 0,74 A G
10001994 228.411 1/1 1,68 A G
10002249 225.422 1/1 0,73 C T
10002676 225.417 1/1 0,37 C T
10002682 228.373 1/1 1,30 C T
10003232 225.417 1/1 0,55 G A
10003248 228.417 1/1 1,59 T C
10003440 225.417 1/1 0,45 A C
10003441 225.417 1/1 0,46 G A
+ cut -f5
+ grep TSTV
+ bcftools stats '-iQUAL>=30 && AD[*:1]>=25' out.vcf
# TSTV, transitions/transversions:
[5]ts/tv
2.47
+ cut -f5
+ grep TSTV
+ bcftools stats '-eQUAL>=30 && AD[*:1]>=25' out.vcf
# TSTV, transitions/transversions:
[5]ts/tv
1.71
+ grep TSTV
+ cut -f5
+ bcftools stats -i 'GT="het"' out.vcf
# TSTV, transitions/transversions:
[5]ts/tv
1.15
+ bcftools norm -f GRCm38_68.19.fa out.flt.vcf -o out.flt.norm.vcf
Lines   total/split/realigned/skipped:	2941/0/548/0
+ bcftools call -mv -Ob -o multi.bcf
Note: none of --samples-file, --ploidy or --ploidy-file given, assuming all sites are diploid
+ bcftools mpileup -a AD -f GRCm38_68.19.fa A_J.bam NZO.bam -Ou
[mpileup] 2 samples in 2 input files
[mpileup] maximum number of reads per input file set to -d 250
+ bcftools index multi.bcf
+ bcftools filter -s LowQual '-iQUAL>=30 && AD[*:1]>=25' -g8 -G10 multi.bcf -Ob -o multi.filt.bcf
+ bcftools index multi.filt.bcf
+ cut -f5
+ grep TSTV
+ bcftools stats -e 'FILTER="PASS"' multi.filt.bcf
# TSTV, transitions/transversions:
[5]ts/tv
1.73
+ bcftools view -H -r 19:10001946 multi.filt.bcf
19	10001946	.	A	G	216.008	PASS	DP=144;VDB=0.175868;SGB=49.7367;RPBZ=-0.58609;MQBZ=-0.958603;MQSBZ=0.986013;BQBZ=-0.629651;SCBZ=-1.43238;FS=0;MQ0F=0;AC=2;AN=4;DP4=33,35,39,35;MQ=59	GT:PL:AD	1/1:255,223,0:0,74	0/0:0,205,255:68,0
+ bcftools view -H -r 19:10072443 multi.filt.bcf
19	10072443	.	T	A	25.093	LowQual	DP=80;VDB=1.97212e-05;SGB=4.00342;RPBZ=4.35645;MQBZ=0;MQSBZ=0;BQBZ=-2.45202;SCBZ=5.03379;FS=0;MQ0F=0;AC=1;AN=4;DP4=42,29,3,5;MQ=60	GT:PL:AD	0/1:59,0,107:18,8	0/0:0,160,255:53,0
+ bcftools query -f %BCSQ -r 19:10088937 multi.filt.annot.bcf
missense|Fads2|ENSMUST00000025567|protein_coding|-|163V>163I|10088937C>T